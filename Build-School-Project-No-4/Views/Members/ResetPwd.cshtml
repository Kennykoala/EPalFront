<div id="VuePage" class="resetpassword container-fluid">
    <!--Bootstrap-->
    <div class="panel panel-primary">
        <div class="panel-heading">Reset Password</div>
        <div class="panel-body">
            <div class="row">

                <div class="form-group">
                    <div class="col-sm-8 col-md-6 col-lg-4 col-xl-4">
                        <label>New Password</label>
                        <input type="password" class="form-control" v-model="form.NewUserPwd" v-bind:class="{ 'is-invaild' : inputDataCheck.passwordError}">
                        <div class="text-danger small mt-1">
                            {{inputDataCheck.passwordErrorMsg}}
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-8 col-md-6 col-lg-4 col-xl-4">
                        <label>Check New Password</label>
                        <input type="password" class="form-control" v-model="form.CheckUserPwd" v-bind:class="{ 'is-invaild' : inputDataCheck.checkPasswordError}">
                        <div class="text-danger small mt-1">
                            {{inputDataCheck.checkPasswordErrorMsg}}
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="panel-footer">
            <button type="button" class="btn btn-primary" v-on:click="DoResetPwd()">Reset Password</button>
        </div>
    </div>

    <!--使用 Bootstrap Modal 樣式，當執行有錯誤時，顯示錯誤訊息-->
    @*<div class="modal fade" id="ErrorAlert" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">錯誤訊息</h4>
                    </div>
                    <div class="modal-body" id="ErrorMsg" style="overflow-x:auto;width:100%;">
                    </div>
                </div>
            </div>
        </div>*@
</div>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script>
    var VuePage = new Vue({
        el: '#VuePage',
        data: function() {
                var data = {
                    form: {
                        NewUserPwd: '',
                        CheckUserPwd: '',
                    },
                    inputDataCheck: {
                        passwordError: false,
                        passwordErrorMsg: '',
                        checkPasswordError: false,
                        checkPasswordErrorMsg: ''
                    }
                };
            return data;
        },
        //isVerify: true,        
        created: function () {
            var ErrorMsg = '@ViewData["ErrorMsg"]';
            if (ErrorMsg != '') {
                alert(ErrorMsg);
                // 解析驗證碼失敗，導回頁面
                window.location.href = "/";
            }
        },
        watch: {
            'form.NewUserPwd': {
                //載入後就開始執行
                //immediate: true,
                handler() {
                    //長度不能小於6碼
                    if (this.form.NewUserPwd.length < 6) {
                        this.inputDataCheck.passwordError = true;
                        this.inputDataCheck.passwordErrorMsg = "密碼長度不得小於6位";
                    }
                    else {
                        this.inputDataCheck.passwordError = false;
                        this.inputDataCheck.passwordErrorMsg = "";
                    }

                    //this.checkVerify();
                }
            },
            'form.CheckUserPwd': {
                //載入後就開始執行
                //immediate: true,
                handler() {
                    //只能數字
                    //let passwordRegexp = /^[0-9]*$/

                    //長度不能小於6碼
                    if (this.form.CheckUserPwd.length < 6) {
                        this.inputDataCheck.checkPasswordError = true;
                        this.inputDataCheck.checkPasswordErrorMsg = "確認密碼長度不得小於6位";
                    }
                    else {
                        this.inputDataCheck.checkPasswordError = false;
                        this.inputDataCheck.checkPasswordErrorMsg = "";
                    }

                    //this.checkVerify();
                }
            },
        },
        methods: {
            // 前端驗證
            GetToken: function () {
                var token = '@Html.AntiForgeryToken()';
                token = $(token).val();
                return token;
            }
             // 重設密碼
            , DoResetPwd: function () {
                var self = this;

                // 組合表單資料
                var postData = {};
                postData['NewUserPwd'] = self.form.NewUserPwd;
                postData['CheckUserPwd'] = self.form.CheckUserPwd;

                // 使用 jQuery Ajax 傳送至後端
                $.ajax({
                    url:'@Url.Action("DoResetPwd", "Members")',
                    method:'POST',
                    dataType:'json',
                    data: { inModel: postData, __RequestVerificationToken: self.GetToken() },
                    success: function (datas) {
                        if (datas.ErrMsg) {
                            swal.fire({
                                title: datas.ErrMsg,
                                icon: "error",
                                //buttons: true,
                                //dangerMode: true
                            });

                            //alert(datas.ErrMsg);
                            return;
                        }
                        //alert(datas.ResultMsg);

                        swal.fire({
                            title: datas.ResultMsg,
                            icon: "success",
                            //buttons: true,
                            //dangerMode: true
                        }).then(function () {
                            window.location.href = "/Home/HomePage";
                        });

                        //window.location.href = "/";

                    },
                    error: function (err) {
                        //$('#ErrorMsg').html(err.responseText);
                        //$('#ErrorAlert').modal('toggle');

                        swal.fire({
                            title: "Failure",
                            icon: "error",
                            //buttons: true,
                            //dangerMode: true
                        });

                        window.location.href = "/Members/ForgetPwd";

                    },
                });
            }
        }
    })
</script>

@section topCSS{

    <style>
        body {
            background-color: black;
        }

        .resetpassword {
            padding-top: 95px;
            padding-left: 50px;
        }

        .panel-heading {
            font-size: 36px;
            font-weight: 600;
        }

        .panel-body label {
            padding-top: 30px;
            padding-bottom: 10px;
            font-size: 20px;
        }

        .panel-footer button {
            margin-top: 20px;
            background-color: #7041E6;
            color: white;
        }

            .panel-footer button:hover {
                background-color: #410ec2;
                color: white;
            }

        @@media screen and (max-width:767px) {
            .resetpassword {
                padding-top: 95px;
                padding-left: 50px;
                padding-right: 50px;
            }

            .panel-heading {
                font-size: 28px;
                font-weight: 600;
            }
        }

    </style>

}