@model AddgameViewModel
<head>
    <!-- font-family -->
    @*<link rel="preconnect" href="https://fonts.googleapis.com">*@
    @*<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>*@
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- Bootstrap -->
    @*<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">*@
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
            crossorigin="anonymous"></script>
    @*<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"
        integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp"
        crossorigin="anonymous"></script>*@
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"
            integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>


<body style="background-color: #120E1B;">

    <div class="">

        @Html.Partial("_AddgamePartial", Model)


    </div>

</body>


@section endJS{
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>


    <script>
        $(function () {
            //$("<br/>").insertAfter("input");
            //$("<br/>").insertAfter("textarea");
            $("<br/>").insertAfter(".form-group");
        });


        //your javascript goes here
        var currentTab = 0;
        document.addEventListener("DOMContentLoaded", function (event) {
            showTab(currentTab);
        });


        function showTab(n) {
            var x = document.getElementsByClassName("tab");
            x[n].style.display = "block";

            if (n == 0) {
                document.getElementById("prevBtn").style.display = "none";
            } else {
                document.getElementById("prevBtn").style.display = "inline";
            }

            if (n == (x.length - 1)) {
                document.getElementById("nextBtn").value = "Submit";
                document.getElementById("nextBtn").innerText = "Submit";
                document.getElementById("nextBtn").classList.add("submitbtn");
                //document.getElementById("nextBtn").type = "submit";
                //document.getElementById("nextBtn").style.display = "none";
                //document.getElementById("btnSubmit").style.display = "inline";
            } else {
                //document.getElementById("btnSubmit").style.display = "none";
                //document.getElementById("nextBtn").style.display = "inline";
                document.getElementById("nextBtn").value = "Next";
                document.getElementById("nextBtn").innerText = "Next";

            }

            //fixStepIndicator(n)
        }

        //function fixStepIndicator(n) {
        //    var i, x = document.getElementsByClassName("step");
        //    for (i = 0; i < x.length; i++) {
        //        x[i].className = x[i].className.replace(" active", "");
        //    }
        //    x[n].className += " active";
        //}


        function nextPrev(n) {
            var x = document.getElementsByClassName("tab");
            if (n == 1 && !validateForm())
                return false;
            x[currentTab].style.display = "none";
            currentTab = currentTab + n;
            if (currentTab >= x.length) {
                //uploadAudio();
                //uploadToCloudinary();

                document.getElementById("becomeForm").submit();

                return false;
                //alert("sdf");
                document.getElementById("nextprevious").style.display = "none";
                document.getElementById("all-steps").style.display = "none";
                //document.getElementById("register").style.display = "none";
            }
            showTab(currentTab);
        }


        function validateForm() {
            var x, y, i, u, s, e, valid = true;
            x = document.getElementsByClassName("tab");
            //取得所有input欄位做驗證
            y = x[currentTab].getElementsByTagName("input");

            u = x[1].getElementsByClassName("uniprice");
            s = x[1].getElementsByClassName("starttime");
            e = x[1].getElementsByClassName("endtime");

            if (currentTab == 0 || currentTab == 2) {
                for (i = 0; i < y.length; i++) {
                    if (y[i].value == "") {
                        y[i].className += " invalid";
                        valid = false;
                    }
                }
            }
            else if (currentTab == 1) {
                for (i = 0; i < s.length; i++) {
                    if ((s[i].value == "") || (e[i].value == "") || (u.value == "")) {
                        //y[i].className += " invalid";
                        valid = false;
                        /*break;*/
                    }
                    else {
                        valid = true;
                        break;
                    }
                }
            }

            if (valid) {
                document.getElementsByClassName("step")[currentTab].className += " finish";
            }
            return valid;
        }







        // changeStyle
        let gamebtn = document.querySelectorAll(".gamebtn");
        let gameActive = document.querySelectorAll(".gameActive");
        gamebtn.forEach((item, idx) => {
            item.addEventListener("click", function () {
                gameActive.forEach(item => {
                    item.style.borderColor = '#120E1B';
                })
                gameActive[idx].style.borderColor = "#7041e6";
            })
        })

        //// changeStyle
        //function changeStyle(element) {

        //    let gameActive = document.getElementsByClassName("gameActive");
        //    let btnImg = document.getElementsByClassName("btnImg");

        //    for (let el of gameActive) {
        //        el.style.borderColor = '#120E1B';
        //        // btnImg.src = "/E-Pal/ChooseAService1/Img_ChooseAService1/Vc.png";
        //    }
        //    element.style.borderColor = "#7041e6";
        //}





        //save audio to Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyCfsXwSLcwmqr6hN8TmELq09rn__vqJyNo",
            authDomain: "bsepal.firebaseapp.com",
            projectId: "bsepal",
            storageBucket: "bsepal.appspot.com",
            messagingSenderId: "925874281844",
            appId: "1:925874281844:web:e04bfd2baf9169c34be021",
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        console.log(firebase);

        function uploadAudio() {
            const ref = firebase.storage().ref();
            const file = document.getElementById('uploadvoice').files[0];
            const name = new Date() + "-" + file.name;
            const metadata = {
                contentType: file.type
            };
            const task = ref.child(name).put(file, metadata);
            task
                .then(snapshot => snapshot.ref.getDownloadURL())
                .then(url => {
                    console.log(url);

                    document.querySelector(".productvoice").value = url;
                    //document.querySelector("#image").src = url;

                    //alert("Video upload successful!")
                    swal.fire({
                        title: "Upload Voice Success",
                        icon: "success",
                        //buttons: true,
                        //dangerMode: true
                    });


                })
                .catch(error => {
                    console.log(error);
                });
        }







        //save image to Cloudinary
        function uploadToCloudinary() {
            var photoUrl = "";

            var cloud_url = 'https://api.cloudinary.com/v1_1/djamumruo/image/upload'
            var cloud_upload_preset = 'roldewr6'
            //var file = event.target.files[0];

            //var fileLen = document.getElementsByClassName('uploadfile').files.length;
            //var voicefile = document.getElementById('uploadvoice').files[0];
            var imagefile = document.getElementById('uploadlistcover').files[0];

            var formData = new FormData();

            //for (var x = 0; x < fileLen; x++) {
            //    formData.append('file[]', document.getElementsByClassName('uploadfile').files[x])
            //}
            //formData.append('file', voicefile);
            formData.append('file', imagefile);
            formData.append('upload_preset', cloud_upload_preset);

            axios({
                url: cloud_url,
                method: 'POST',
                Headers: {
                    'Content-Type': 'multipart/form-data'
                },
                data: formData
            }).then(function (res) {
                console.log(res);
                photoUrl = res.data.secure_url;
                console.log(photoUrl);

                document.querySelector(".productimg").value = photoUrl;

                //$("#imageUpload").change(function () {
                //    readURL(photoUrl);
                //});
                //SaveImageViaAjax(memberId, photoUrl);

            }).catch(function (err) {
                console.error(err);
            });
        }




        //save Creator image to Cloudinary
        function uploadCreatorToCloudinary() {
            var photoUrl = "";

            var cloud_url = 'https://api.cloudinary.com/v1_1/djamumruo/image/upload'
            var cloud_upload_preset = 'roldewr6'
            //var file = event.target.files[0];

            //var fileLen = document.getElementsByClassName('uploadfile').files.length;
            //var voicefile = document.getElementById('uploadvoice').files[0];
            var imagefile = document.getElementById('uploadcreatoravatar').files[0];

            var formData = new FormData();

            //for (var x = 0; x < fileLen; x++) {
            //    formData.append('file[]', document.getElementsByClassName('uploadfile').files[x])
            //}
            //formData.append('file', voicefile);
            formData.append('file', imagefile);
            formData.append('upload_preset', cloud_upload_preset);

            axios({
                url: cloud_url,
                method: 'POST',
                Headers: {
                    'Content-Type': 'multipart/form-data'
                },
                data: formData
            }).then(function (res) {
                console.log(res);
                photoUrl = res.data.secure_url;
                console.log(photoUrl);

                document.querySelector(".creatorimg").value = photoUrl;

                //$("#imageUpload").change(function () {
                //    readURL(photoUrl);
                //});
                //SaveImageViaAjax(memberId, photoUrl);

            }).catch(function (err) {
                console.error(err);
            });
        }





        //product image preview
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    //$('.upload_cover').resize(function() {
                    //    if ($(this).height() > 200) {
                    //        $(this).css('height', 'auto');
                    //    }
                    //});

                    $('.upload_cover').css({ 'width': '', 'height': '', 'background-size': 'contain', 'background-repeat': 'no-repeat', 'border': 'transparent', 'background-color': '#120E1B' });


                    $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
                    document.querySelector("#imagePreview img").src = "";

                    //$('#imagePreview img').css('background-image', 'url(' + e.target.result + ')');
                    //$('#imagePreview').hide();
                    //$('#imagePreview').fadeIn(650);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }


        //creator image preview
        function readcreatorURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    //$('.upload_cover').resize(function() {
                    //    if ($(this).height() > 200) {
                    //        $(this).css('height', 'auto');
                    //    }
                    //});

                    $('.upload_cover_creator').css({ 'width': '', 'height': '', 'background-size': 'contain', 'background-repeat': 'no-repeat', 'border': 'transparent', 'background-color': '#120E1B' });


                    $('#imagePreview_creator').css('background-image', 'url(' + e.target.result + ')');
                    document.querySelector("#imagePreview_creator img").src = "";

                    //$('#imagePreview img').css('background-image', 'url(' + e.target.result + ')');
                    //$('#imagePreview').hide();
                    //$('#imagePreview').fadeIn(650);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }


        //upload product image to cloud then get file Url
        $("#uploadlistcover").change(function () {
            readURL(this);
            uploadToCloudinary();
        });

        $("#uploadcreatoravatar").change(function () {
            readcreatorURL(this);
            uploadCreatorToCloudinary();
        });




        $("#uploadvoice").change(function () {
            uploadAudio();
        });

    </script>

}


@section topCSS{
    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            /*color: white;*/
        }
        /*        .container {
            display: block;
            position: relative;
            padding-left: 35px;
            margin-bottom: 12px;
            cursor: pointer;
        }*/
        body {
            position: relative;
        }

        #nextprevious {
            position: absolute;
            bottom: 50px;
            left: 20px;
        }

        .tab {
            display: none
        }

        #nextprevious button {
            background-color: #7041E6;
            color: #ffffff;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 50px;
            border: 1px solid transparent;
            width: 100px;
            display: inline-block;
        }

            #nextprevious button:hover {
                opacity: 0.8;
            }

        #nextprevious #prevBtn {
            background-color: #21212C;
            border: 0;
        }

        #becomeForm {
            margin: 0px auto;
            border-radius: 10px;
            position: relative;
        }

        #nextprevious .submitinput {
            background-color: #7041E6;
            color: #ffffff;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 50px;
            border: 1px solid transparent;
            width: 100px;
            display: none;
        }







        .tab-content input[type="radio"] {
            /*display: none;*/
        }


        .gameCard span {
            margin-left: 4px;
            font-size: 12px;
            font-weight: 400;
            margin-top: 8px;
        }

        .gameCard input {
            margin-top: 10px;
        }



        .step {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            /*background-color: #bbbbbb;*/
            background-color: transparent;
            border: none;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.5;
        }

            .step.active {
                opacity: 1
            }

            .step.finish {
                background-color: #4CAF50;
                background-color: transparent;
            }

        .all-steps {
            text-align: center;
            position: absolute;
            bottom: 30px;
        }


        .introDesc {
            font-size: 12px;
            color: #8D65EA;
            line-height: 1.5;
            padding-top: 5px;
            padding-bottom: 5px;
        }

        /*list pic*/
        .listCover .upload_cover {
            position: relative;
            width: 100px;
            height: 100px;
            text-align: center;
            cursor: pointer;
            background: #21212C;
            border: 1px dashed #595656;
            border-radius: 5px;
        }

        .listCover .uploadfile {
            display: none;
        }

        /*creator pic*/
        .creatorCover .upload_cover_creator {
            position: relative;
            width: 100px;
            height: 100px;
            text-align: center;
            cursor: pointer;
            background: #21212C;
            border: 1px dashed #595656;
            border-radius: 5px;
        }

        .creatorCover .uploadfile {
            display: none;
        }



        .upload_icon img {
            position: absolute;
            left: 0;
            width: 30%;
            top: 35%;
            left: 35%;
        }

        .voiceRecord label {
            background-color: #21212C;
            color: white;
        }

            .voiceRecord label:hover {
                background-color: #21212C;
                color: white;
                opacity: 0.8;
            }


        .productimgtitle {
        }

        .productimg {
        }


        /* epalPage */
        .epalPage1 {
            height: 100%;
            /*overflow: auto;*/
            position: relative;
        }

        .pageWrapper {
            width: 100%;
            background-position: 50%;
            background-size: cover;
        }

        .content {
            padding: 100px 20px;
        }

        .title {
            margin-bottom: 24px;
            line-height: 1;
            font-size: 24px;
            font-weight: 500;
        }

        /* pageLoading */
        .pageLoading {
            position: relative;
        }

        .pageContainer {
            transition: opacity .3s;
        }

        .addGame {
            width: 100%;
        }

        .desc {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 14px;
            color: #c4c3e6;
            margin-bottom: 24px;
        }

        /* gameTabs */
        .gameTabs {
            margin-bottom: 24px;
        }

        .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
            border-bottom: 6px solid transparent !important;
            display: flex !important;
            align-items: center !important;
            text-align: center !important;
            transition: color .3s !important;
            margin: 0 3px !important;
            border-color: #7041e6 !important;
            cursor: pointer;
        }

        .purple-text-border {
            color: #7041e6 !important;
            border-color: #7041e6 !important;
        }

        .nav-item a {
            /*font-size: 14px;*/
            color: #c4c3e6;
        }

        a:hover {
            /*color: #7041e6 !important;*/
        }

        .nav-link-tab:focus, .nav-link-tab:hover {
            color: #7041e6 !important;
        }

        .nav-tabs .nav-link {
            border: none !important;
        }

        .nav-tabs {
            border-bottom: 1px solid #c4c3e6 !important;
        }

            .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
                background-color: transparent !important;
            }

        .nav nav-tabs {
            display: flex;
            flex-wrap: wrap;
            padding-left: 0;
            margin-bottom: 0;
            list-style: none;
        }

        .nav-link-tab {
            font-size: 14px !important;
            color: #c4c3e6 !important;
        }

        /* list */
        .list {
            width: 253px;
            margin: 25px 35px 0;
            margin-top: 25px !important;
            cursor: pointer;
        }

        .gameCard {
            width: 253px;
            margin: 0 23px 24px 0;
            cursor: pointer;
        }

        .gameActive {
            position: relative;
            width: 253px;
            height: 98px;
            border-radius: 8px;
            outline: none;
            border: 2px solid transparent;
            cursor: pointer;
            overflow: hidden;
        }

            .gameActive:active {
                border-color: #7041e6;
            }

        .activeNow:hover {
            border-color: #7041e6;
        }

        .imgMain img {
            width: 100%;
            height: 100%;
            display: block;
        }

        .gameCard .gameActive .imgMark {
            position: absolute;
            right: 0;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 1;
        }

        .gameCard .activeNow .imgMark {
            background: rgba(47,46,73,.1);
        }

        .imgLogo img {
            width: 100%;
            height: 100%;
            display: block;
        }

        .gameCard .gameActive .imgLogo {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
        }

        .gameCard .gameActive:hover .imgLogo {
            transition: all .3s linear;
            transform: scale(1.1);
        }

        /* btn */
        .gameCard .chooseBtn {
            margin-top: 12px;
            display: flex;
            cursor: pointer;
        }

            .gameCard .chooseBtn .chooseBtnImg {
                width: 16px;
                height: 16px;
            }

        .gameCard .chooseBtnImg img {
            width: 100%;
            display: block;
            border-style: none;
        }

        .chooseBtn span {
            margin-left: 4px;
            font-size: 12px;
            font-weight: 400;
        }

        /* desc */
        .gameCard .desc {
            font-size: 12px;
            font-weight: 400;
            color: #c4c3e6;
            line-height: 18px;
            margin-top: 4px;
        }

        /* button */
        .buttonWrapper {
            margin-left: auto;
        }

        /*        .btn-outline-dark {
            position: relative !important;
            border: 0 !important;
            outline: 0 !important;
            margin-top: 0% !important;
            margin-bottom: 5% !important;
            width: 150px !important;
            padding: 9px !important;
            text-align: center !important;
            text-decoration: none !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            box-sizing: border-box !important;
            border: 1px solid grey !important;
            color: grey !important;
            background: transparent !important;
            background-size: 100% !important;
            border-radius: 400px !important;
        }*/

        .btn:hover {
            color: white !important;
            background-color: #7041e6 !important;
            border-color: #2f244d !important;
        }

        /* selectgameAction */

        /* .chooseBtnImg img{
            background-image: url(/E-Pal/ChooseAService1/Img_ChooseAService1/Vc.png);
        } */


        /*定义滚动条高宽及背景
 高宽分别对应横竖滚动条的尺寸*/
        .gamelistbox::-webkit-scrollbar {
            width: 16px;
            height: 16px;
            background-color: #F5F5F5;
        }
        /*定义滚动条轨道
 内阴影+圆角*/
        .gamelistbox::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
            /*border-radius: 10px;*/
            background-color: #F5F5F5;
        }
        /*定义滑块
 内阴影+圆角*/
        .gamelistbox::-webkit-scrollbar-thumb {
            /*border-radius: 10px;*/
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
            background-color: #555;
        }



        @@media screen and (max-width:767px) {
            .content {
                margin-bottom: 50px;
            }
        }

        @@media screen and (min-width:768px) {

            .list {
                display: grid;
                grid-template-columns: repeat(2,120%);
            }

            .list {
                margin: 0 23px 24px 0;
            }

            .epalButtonWrapper {
                margin: 0 23px 24px 0;
            }
        }

        @@media screen and (min-width:996px) {

            .list {
                display: grid;
                grid-template-columns: repeat(3,120%);
            }

            .list {
                margin: 0 23px 24px 0;
            }

            .epalButtonWrapper {
                margin: 0 23px 24px 0;
            }
        }

        @@media screen and (min-width:1200px) {

            .list {
                display: grid;
                grid-template-columns: repeat(4,115%);
            }

            .list {
                margin: 0 23px 24px 0;
            }

            .epalButtonWrapper {
                margin: 0 23px 24px 0;
            }
        }

        @@media screen and (min-width:1500px) {

            .list {
                display: grid;
                grid-template-columns: repeat(5,115%);
            }

            .list {
                margin: 0 23px 24px 0;
            }

            .epalButtonWrapper {
                margin: 0 23px 24px 0;
            }
        }

        @@media screen and (min-width:1800px) {

            .list {
                display: grid;
                grid-template-columns: repeat(6,115%);
            }

            .list {
                margin: 0 23px 24px 0;
            }

            .epalButtonWrapper {
                margin: 0 23px 24px 0;
            }
        }
    </style>

}
